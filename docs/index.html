<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signal Deck — The oscilloscope for Home Assistant</title>
  <meta name="description" content="A safe Python REPL Lovelace card for Home Assistant with built-in AI analyst, ECharts visualisations, and deep state exploration — all running in your browser." />
  <meta name="keywords" content="Home Assistant, Lovelace, Python, REPL, WASM, WebAssembly, HACS, observability, debugging" />
  <meta property="og:title" content="Signal Deck — The oscilloscope for Home Assistant" />
  <meta property="og:description" content="A safe Python REPL embedded in Lovelace with built-in AI analyst, ECharts visualisations, and deep state exploration." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://rsr5.github.io/signal-deck" />
  <!-- <meta property="og:image" content="https://rsr5.github.io/signal-deck/images/og-card.png" /> -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #1c2128;
      --bg-card: #1c2128;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --text-muted: #656d76;
      --border-color: #30363d;
      --accent: #00e5ff;
      --accent-hover: #00b8d4;
      --accent-subtle: rgba(0, 229, 255, 0.15);
      --accent-alt: #ff6e40;
      --accent-alt-subtle: rgba(255, 110, 64, 0.15);
      --success: #3fb950;
      --warning: #d29922;
      --danger: #f85149;
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'JetBrains Mono', 'Iosevka', 'Fira Code', monospace;
      --max-width: 1200px;
      --sidebar-width: 240px;
      --nav-height: 60px;
      --radius: 8px;
      --radius-lg: 12px;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; scroll-padding-top: calc(var(--nav-height) + 24px); }
    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; transition: color 0.15s; }
    a:hover { color: var(--accent-hover); }
    img { max-width: 100%; height: auto; border-radius: var(--radius); }
    code { font-family: var(--font-mono); font-size: 0.9em; }
    .top-nav {
      position: sticky; top: 0; z-index: 100;
      background: rgba(13, 17, 23, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-color);
      height: var(--nav-height);
      display: flex; align-items: center; padding: 0 24px;
    }
    .top-nav .logo {
      font-weight: 700; font-size: 1.1rem; color: var(--text-primary);
      display: flex; align-items: center; gap: 8px;
    }
    .top-nav .logo .icon { font-size: 1.4rem; }
    .top-nav-links { margin-left: auto; display: flex; gap: 20px; align-items: center; }
    .top-nav-links a { color: var(--text-secondary); font-size: 0.875rem; font-weight: 500; }
    .top-nav-links a:hover { color: var(--text-primary); }
    .github-link { display: flex; align-items: center; gap: 6px; }
    .github-link svg { width: 20px; height: 20px; fill: currentColor; }
    .layout {
      display: grid; grid-template-columns: var(--sidebar-width) 1fr;
      max-width: var(--max-width); margin: 0 auto; gap: 48px; padding: 32px 24px;
    }
    .sidebar {
      position: sticky; top: calc(var(--nav-height) + 24px); align-self: start;
      max-height: calc(100vh - var(--nav-height) - 48px); overflow-y: auto; padding-right: 16px;
    }
    .sidebar::-webkit-scrollbar { width: 3px; }
    .sidebar::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    .sidebar h4 {
      font-size: 0.7rem; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.08em; color: var(--text-muted); margin-top: 20px; margin-bottom: 8px;
    }
    .sidebar h4:first-child { margin-top: 0; }
    .sidebar a {
      display: block; padding: 4px 0; font-size: 0.82rem;
      color: var(--text-secondary); line-height: 1.5;
    }
    .sidebar a:hover { color: var(--accent); }
    .sidebar a.active { color: var(--accent); font-weight: 500; }
    .content { min-width: 0; max-width: 820px; }
    .hero { padding: 48px 0 40px; border-bottom: 1px solid var(--border-color); margin-bottom: 48px; }
    .hero h1 {
      font-size: 2.8rem; font-weight: 700; line-height: 1.15; margin-bottom: 16px;
      background: linear-gradient(135deg, var(--accent), #76ff03);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .hero .subtitle {
      font-size: 1.15rem; color: var(--text-secondary);
      line-height: 1.65; max-width: 620px; margin-bottom: 24px;
    }
    .badges { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 28px; }
    .badge {
      display: inline-flex; align-items: center; gap: 5px; padding: 4px 12px;
      border-radius: 20px; font-size: 0.75rem; font-weight: 500; font-family: var(--font-mono);
    }
    .badge.alpha { background: var(--accent-alt-subtle); color: var(--accent-alt); border: 1px solid rgba(255, 110, 64, 0.3); }
    .badge.version { background: var(--accent-subtle); color: var(--accent); border: 1px solid rgba(0, 229, 255, 0.3); }
    .badge.license { background: rgba(63, 185, 80, 0.15); color: var(--success); border: 1px solid rgba(63, 185, 80, 0.3); }
    .badge.hacs { background: rgba(210, 153, 34, 0.15); color: var(--warning); border: 1px solid rgba(210, 153, 34, 0.3); }
    .hero-actions { display: flex; gap: 12px; flex-wrap: wrap; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px;
      border-radius: var(--radius); font-size: 0.875rem; font-weight: 600;
      transition: all 0.2s; border: 1px solid transparent;
    }
    .btn-primary { background: var(--accent); color: var(--bg-primary); }
    .btn-primary:hover { background: var(--accent-hover); color: var(--bg-primary); }
    .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border-color: var(--border-color); }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
    .section { margin-bottom: 56px; }
    .section h2 {
      font-size: 1.65rem; font-weight: 700; margin-bottom: 16px; padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color); color: var(--text-primary);
    }
    .section h3 {
      font-size: 1.15rem; font-weight: 600; margin-top: 32px;
      margin-bottom: 12px; color: var(--text-primary);
    }
    .section h4 {
      font-size: 1rem; font-weight: 600; margin-top: 24px;
      margin-bottom: 8px; color: var(--text-primary);
    }
    .section p { margin-bottom: 16px; color: var(--text-secondary); line-height: 1.7; }
    .section ul, .section ol { margin-bottom: 16px; padding-left: 24px; color: var(--text-secondary); }
    .section li { margin-bottom: 6px; line-height: 1.6; }
    .section li code { background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-size: 0.85em; color: var(--accent); }
    pre {
      background: var(--bg-secondary) !important; border: 1px solid var(--border-color);
      border-radius: var(--radius); padding: 16px 20px; overflow-x: auto;
      margin-bottom: 16px; position: relative;
    }
    pre code {
      font-size: 0.8rem; line-height: 1.6;
      background: none !important; padding: 0 !important; color: var(--text-primary);
    }
    p code, li code, td code {
      background: var(--bg-tertiary); padding: 2px 6px;
      border-radius: 4px; font-size: 0.85em; color: var(--accent);
    }
    table { width: 100%; border-collapse: collapse; margin-bottom: 16px; font-size: 0.875rem; }
    th, td { text-align: left; padding: 10px 14px; border-bottom: 1px solid var(--border-color); }
    th {
      font-weight: 600; color: var(--text-primary); background: var(--bg-secondary);
      font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.04em;
    }
    td { color: var(--text-secondary); }
    tr:hover td { background: rgba(0, 229, 255, 0.03); }
    .feature-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px; margin-bottom: 24px;
    }
    .feature-card {
      background: var(--bg-card); border: 1px solid var(--border-color);
      border-radius: var(--radius-lg); padding: 20px; transition: border-color 0.2s;
    }
    .feature-card:hover { border-color: var(--accent); }
    .feature-card .icon { font-size: 1.6rem; margin-bottom: 10px; }
    .feature-card h4 { font-size: 0.95rem; font-weight: 600; margin-bottom: 6px; color: var(--text-primary); margin-top: 0; }
    .feature-card p { font-size: 0.82rem; color: var(--text-secondary); line-height: 1.5; margin: 0; }
    .callout {
      border-left: 3px solid; padding: 14px 18px;
      border-radius: 0 var(--radius) var(--radius) 0; margin-bottom: 16px; font-size: 0.875rem;
    }
    .callout.info { border-color: var(--accent); background: var(--accent-subtle); color: var(--accent); }
    .callout.warning { border-color: var(--warning); background: rgba(210, 153, 34, 0.1); color: var(--warning); }
    .callout.danger { border-color: var(--danger); background: rgba(248, 81, 73, 0.1); color: var(--danger); }
    .callout strong { display: block; margin-bottom: 4px; }
    .arch-diagram {
      background: var(--bg-secondary); border: 1px solid var(--border-color);
      border-radius: var(--radius-lg); padding: 24px; font-family: var(--font-mono);
      font-size: 0.78rem; line-height: 1.5; color: var(--text-secondary);
      overflow-x: auto; margin-bottom: 16px; white-space: pre;
    }
    .arch-diagram .layer-ts { color: #58a6ff; }
    .arch-diagram .layer-rust { color: var(--accent-alt); }
    .arch-diagram .layer-monty { color: var(--success); }
    kbd {
      display: inline-block; padding: 2px 7px; font-family: var(--font-mono); font-size: 0.78rem;
      background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px;
      box-shadow: 0 1px 0 var(--border-color); color: var(--text-primary);
    }
    .screenshot {
      border: 1px solid var(--border-color); border-radius: var(--radius-lg);
      overflow: hidden; margin-bottom: 24px; box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
    }
    .screenshot img { display: block; width: 100%; border-radius: 0; }
    .screenshot-caption {
      text-align: center; font-size: 0.8rem; color: var(--text-muted);
      margin-top: 8px; margin-bottom: 24px;
    }
    .media-placeholder {
      border: 2px dashed var(--border-color); border-radius: var(--radius-lg);
      padding: 48px 24px; text-align: center; color: var(--text-muted);
      font-size: 0.85rem; margin-bottom: 24px; background: rgba(0, 229, 255, 0.02);
    }
    .media-placeholder .placeholder-icon { font-size: 2rem; margin-bottom: 8px; display: block; }
    .media-placeholder .placeholder-hint {
      font-size: 0.75rem; font-family: var(--font-mono);
      color: var(--text-muted); margin-top: 4px; opacity: 0.7;
    }
    .footer {
      max-width: var(--max-width); margin: 0 auto; padding: 32px 24px;
      border-top: 1px solid var(--border-color); text-align: center;
      font-size: 0.8rem; color: var(--text-muted);
    }
    @media (max-width: 768px) {
      .layout { grid-template-columns: 1fr; gap: 24px; padding: 16px; }
      .sidebar { display: none; }
      .hero h1 { font-size: 2rem; }
      .hero { padding: 32px 0 24px; }
      .feature-grid { grid-template-columns: 1fr; }
      .media-placeholder { padding: 32px 16px; }
    }
  </style>
</head>
<body>

  <!-- Top Nav -->
  <nav class="top-nav">
    <a href="#" class="logo"><span class="icon">&#x1F4E1;</span> Signal Deck</a>
    <div class="top-nav-links">
      <a href="#features">Features</a>
      <a href="#installation">Install</a>
      <a href="#api-reference">API</a>
      <a href="#architecture">Architecture</a>
      <a href="https://github.com/rsr5/signal-deck" class="github-link">
        <svg viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        GitHub
      </a>
    </div>
  </nav>

  <!-- Layout -->
  <div class="layout">

    <!-- Sidebar -->
    <aside class="sidebar">
      <h4>Getting Started</h4>
      <a href="#features">Features</a>
      <a href="#installation">Installation</a>
      <a href="#quick-start">Quick Start</a>
      <a href="#card-config">Card Configuration</a>

      <h4>Using the REPL</h4>
      <a href="#repl-basics">REPL Basics</a>
      <a href="#magic-commands">Magic Commands</a>
      <a href="#auto-resolve">Auto-resolve</a>
      <a href="#keyboard-shortcuts">Keyboard Shortcuts</a>

      <h4>Python API</h4>
      <a href="#api-reference">Overview</a>
      <a href="#api-state">State &amp; Entities</a>
      <a href="#api-history">History &amp; Diagnostics</a>
      <a href="#api-calendar">Calendar Events</a>
      <a href="#api-rooms">Rooms &amp; Services</a>
      <a href="#api-utilities">Utilities</a>
      <a href="#api-charts">Charts</a>

      <h4>AI Analyst</h4>
      <a href="#ai-analyst">Overview</a>

      <h4>Architecture</h4>
      <a href="#architecture">Three Layers</a>
      <a href="#data-flow">Data Flow</a>
      <a href="#security">Security Model</a>

      <h4>Development</h4>
      <a href="#development">Building</a>
      <a href="#testing">Testing</a>
      <a href="#project-structure">Project Structure</a>
      <a href="#contributing">Contributing</a>

      <h4>More</h4>
      <a href="#faq">FAQ</a>
      <a href="#changelog">Changelog</a>
    </aside>

    <!-- Content -->
    <main class="content">

      <!-- Hero -->
      <section class="hero" id="hero">
        <div class="badges">
          <span class="badge alpha">&#x26A1; Alpha</span>
          <span class="badge version">v0.1.0-alpha.1</span>
          <span class="badge license">MIT</span>
          <span class="badge hacs">HACS Custom</span>
        </div>
        <h1>Signal Deck</h1>
        <p class="subtitle">
          The oscilloscope for Home Assistant. A safe Python REPL embedded in Lovelace
          with built-in AI analyst, ECharts visualisations, and deep state exploration &mdash;
          powered by WebAssembly, runs entirely in your browser.
        </p>

        <!-- SCREENCAST PLACEHOLDER -->
        <div class="media-placeholder">
          <span class="placeholder-icon">&#x1F3AC;</span>
          Screencast &mdash; 30-60s demo of the REPL in action
          <span class="placeholder-hint">docs/images/screencast.mp4 or animated GIF</span>
        </div>

        <div class="hero-actions">
          <a href="#installation" class="btn btn-primary">&#x26A1; Get Started</a>
          <a href="https://github.com/rsr5/signal-deck" class="btn btn-secondary">View on GitHub &rarr;</a>
        </div>

        <!-- HERO SCREENSHOT PLACEHOLDER -->
        <div class="media-placeholder" style="margin-top: 28px;">
          <span class="placeholder-icon">&#x1F4F8;</span>
          Hero screenshot &mdash; full card showing REPL with rendered output
          <span class="placeholder-hint">docs/images/hero-screenshot.png (1200x720 recommended)</span>
        </div>
      </section>

      <!-- Features -->
      <section class="section" id="features">
        <h2>Features</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="icon">&#x1F40D;</div>
            <h4>Python REPL</h4>
            <p>Real Python running in WebAssembly via Monty. Safe, sandboxed, instant &mdash; no backend required.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x1F4CA;</div>
            <h4>ECharts Visualisations</h4>
            <p>History timelines, binary sensor lanes, and custom charts rendered with Apache ECharts.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x1F916;</div>
            <h4>AI Analyst</h4>
            <p>Built-in analyst powered by HA Conversation. Ask &ldquo;why did this happen?&rdquo; in plain English.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x1F50D;</div>
            <h4>Deep State Exploration</h4>
            <p>Browse entities, attributes, rooms, and areas. Auto-resolve short names like <code>kitchen_temp</code>.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x1F4C5;</div>
            <h4>Calendar Events</h4>
            <p>Query calendar events with <code>events()</code>. Rich auto-rendering with colour-coded timelines.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x26A1;</div>
            <h4>Rich Auto-render</h4>
            <p>Entity cards, state tables, and charts render automatically. Just type an expression &mdash; the REPL picks the best view.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x1F512;</div>
            <h4>Safe by Default</h4>
            <p>Read-only state access. Service calls require explicit arming. No filesystem, no network, no eval.</p>
          </div>
          <div class="feature-card">
            <div class="icon">&#x2699;&#xFE0F;</div>
            <h4>Rust Shell Engine</h4>
            <p>Command parsing, data transforms, and render-spec generation in Rust compiled to WASM. Fast and tiny.</p>
          </div>
        </div>
        <!-- FEATURE SCREENSHOTS PLACEHOLDER -->
        <div class="media-placeholder">
          <span class="placeholder-icon">&#x1F4F8;</span>
          Feature screenshots &mdash; 2-3 screenshots showing different features (entity cards, charts, AI analyst)
          <span class="placeholder-hint">docs/images/feature-*.png (800x500 each)</span>
        </div>
      </section>

      <!-- Installation -->
      <section class="section" id="installation">
        <h2>Installation</h2>
        <h3>HACS (Recommended)</h3>
        <ol>
          <li>Open HACS &rarr; <strong>Frontend</strong> &rarr; three-dot menu &rarr; <strong>Custom repositories</strong></li>
          <li>Add <code>https://github.com/rsr5/signal-deck</code> as category <strong>Dashboard</strong></li>
          <li>Search for <strong>Signal Deck</strong> and click <strong>Install</strong></li>
          <li>Reload your browser</li>
        </ol>
        <h3>Manual</h3>
        <ol>
          <li>Download <code>signal-deck.js</code> from the <a href="https://github.com/rsr5/signal-deck/releases">latest release</a></li>
          <li>Copy it to <code>config/www/signal-deck.js</code></li>
          <li>In HA &rarr; <strong>Settings &rarr; Dashboards &rarr; Resources</strong>, add <code>/local/signal-deck.js</code> as JavaScript Module</li>
          <li>Reload your browser</li>
        </ol>
      </section>

      <!-- Quick Start -->
      <section class="section" id="quick-start">
        <h2>Quick Start</h2>
        <p>Add a new card to any dashboard and paste this YAML:</p>
        <pre><code class="language-yaml">type: custom:signal-deck
mode: embedded     # or "overlay" for floating panel
height: 420</code></pre>
        <p>Once the card loads, try these commands in the REPL:</p>
        <pre><code class="language-python"># List all entities
ls()

# Inspect a sensor
get("sensor.living_room_temperature")

# View 6 hours of history
history("sensor.living_room_temperature", "6h")

# Upcoming calendar events
events("calendar.home", "24h")</code></pre>
        <!-- QUICK START SCREENSHOT PLACEHOLDER -->
        <div class="media-placeholder">
          <span class="placeholder-icon">&#x1F4F8;</span>
          Quick start screenshot &mdash; REPL showing the commands above with rendered output
          <span class="placeholder-hint">docs/images/quick-start.png</span>
        </div>
      </section>

      <!-- Card Configuration -->
      <section class="section" id="card-config">
        <h2>Card Configuration</h2>
        <table>
          <thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>mode</code></td><td>string</td><td><code>"embedded"</code></td><td><code>"embedded"</code> (inline card) or <code>"overlay"</code> (floating panel)</td></tr>
            <tr><td><code>height</code></td><td>number</td><td><code>420</code></td><td>Card height in pixels (embedded mode)</td></tr>
            <tr><td><code>font_size</code></td><td>number</td><td><code>13</code></td><td>REPL font size in pixels</td></tr>
            <tr><td><code>startup</code></td><td>string[]</td><td><code>[]</code></td><td>Python commands to run on card load</td></tr>
            <tr><td><code>analyst_entity</code></td><td>string</td><td>&mdash;</td><td>Conversation agent entity for AI analyst</td></tr>
          </tbody>
        </table>
        <!-- OVERLAY MODE SCREENSHOT PLACEHOLDER -->
        <div class="media-placeholder">
          <span class="placeholder-icon">&#x1F4F8;</span>
          Overlay mode screenshot &mdash; showing the floating panel over a dashboard
          <span class="placeholder-hint">docs/images/overlay-mode.png</span>
        </div>
      </section>

      <!-- REPL Basics -->
      <section class="section" id="repl-basics">
        <h2>Using the REPL</h2>
        <p>Signal Deck gives you a Python prompt inside your dashboard. Type any expression and press <kbd>Enter</kbd> to evaluate it. Results are automatically rendered as rich cards, tables, or charts when possible.</p>

        <h3 id="magic-commands">Magic Commands</h3>
        <p>Prefix commands with <code>%</code> for shell-level operations:</p>
        <table>
          <thead><tr><th>Command</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>%ls</code></td><td>List entities (with optional domain/pattern filter)</td></tr>
            <tr><td><code>%get &lt;entity&gt;</code></td><td>Inspect a single entity with all attributes</td></tr>
            <tr><td><code>%history &lt;entity&gt; &lt;period&gt;</code></td><td>Fetch and chart entity history</td></tr>
            <tr><td><code>%events &lt;calendar&gt; &lt;period&gt;</code></td><td>List upcoming calendar events</td></tr>
            <tr><td><code>%rooms</code></td><td>Show rooms/areas and their entities</td></tr>
            <tr><td><code>%services &lt;domain&gt;</code></td><td>List available services for a domain</td></tr>
            <tr><td><code>%hist</code></td><td>Show command history</td></tr>
            <tr><td><code>%fmt &lt;format&gt;</code></td><td>Set output format (table, json, csv)</td></tr>
            <tr><td><code>%clear</code></td><td>Clear the REPL output</td></tr>
            <tr><td><code>:help</code></td><td>Show the built-in help reference</td></tr>
          </tbody>
        </table>

        <h3 id="auto-resolve">Auto-resolve</h3>
        <p>You don't need to type full entity IDs. Signal Deck fuzzy-matches short names:</p>
        <pre><code class="language-python"># These all work:
get("kitchen_temp")           # matches sensor.kitchen_temperature
get("living_room_motion")     # matches binary_sensor.living_room_motion
history("front_door", "12h")  # matches lock.front_door</code></pre>

        <h3 id="keyboard-shortcuts">Keyboard Shortcuts</h3>
        <table>
          <thead><tr><th>Key</th><th>Action</th></tr></thead>
          <tbody>
            <tr><td><kbd>Enter</kbd></td><td>Execute current line</td></tr>
            <tr><td><kbd>Up</kbd> / <kbd>Down</kbd></td><td>Navigate command history</td></tr>
            <tr><td><kbd>Ctrl</kbd>+<kbd>L</kbd></td><td>Clear output</td></tr>
            <tr><td><kbd>Ctrl</kbd>+<kbd>C</kbd></td><td>Cancel / clear input</td></tr>
            <tr><td><kbd>Tab</kbd></td><td>Auto-complete entity names</td></tr>
          </tbody>
        </table>
      </section>

      <!-- API Reference -->
      <section class="section" id="api-reference">
        <h2>Python API Reference</h2>
        <p>All functions are available at the top level &mdash; no imports needed.</p>

        <h3 id="api-state">State &amp; Entities</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>ls()</code></td><td>List all entities. Optional: <code>ls("sensor")</code> to filter by domain.</td></tr>
            <tr><td><code>get(entity)</code></td><td>Get full state + attributes for an entity. Supports auto-resolve.</td></tr>
            <tr><td><code>state(entity)</code></td><td>Get just the state value as a string.</td></tr>
            <tr><td><code>attrs(entity)</code></td><td>Get just the attributes dict.</td></tr>
            <tr><td><code>attr(entity, key)</code></td><td>Get a single attribute value.</td></tr>
            <tr><td><code>show(value)</code></td><td>Explicitly render any value with rich auto-display.</td></tr>
          </tbody>
        </table>

        <h3 id="api-history">History &amp; Diagnostics</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>history(entity, period)</code></td><td>Fetch state history. Period: <code>"1h"</code>, <code>"6h"</code>, <code>"1d"</code>, <code>"7d"</code>.</td></tr>
            <tr><td><code>changed(entity, period)</code></td><td>List state changes with timestamps.</td></tr>
            <tr><td><code>last_changed(entity)</code></td><td>When the entity last changed state.</td></tr>
          </tbody>
        </table>
        <div class="callout info">
          <strong>Auto-render</strong>
          Calling <code>history()</code> on a numeric sensor automatically renders an ECharts timeline. Binary sensors get lane-style charts.
        </div>

        <h3 id="api-calendar">Calendar Events</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>events(calendar, period)</code></td><td>Fetch upcoming events. Period: <code>"24h"</code>, <code>"7d"</code>, etc.</td></tr>
          </tbody>
        </table>
        <p>Returns a list of <code>CalendarEvent</code> objects with these fields:</p>
        <table>
          <thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>summary</code></td><td>str</td><td>Event title</td></tr>
            <tr><td><code>start</code></td><td>str</td><td>Start time (ISO 8601 or date)</td></tr>
            <tr><td><code>end</code></td><td>str</td><td>End time (ISO 8601 or date)</td></tr>
            <tr><td><code>description</code></td><td>str or None</td><td>Event description</td></tr>
            <tr><td><code>location</code></td><td>str or None</td><td>Event location</td></tr>
            <tr><td><code>all_day</code></td><td>bool</td><td>Whether this is an all-day event</td></tr>
          </tbody>
        </table>
        <pre><code class="language-python"># Upcoming 24 hours
events("calendar.home", "24h")

# Next 7 days from work calendar
events("calendar.work", "7d")

# Auto-renders as a colour-coded event timeline</code></pre>
        <div class="callout info">
          <strong>Rich rendering</strong>
          Calendar events auto-render with colour-coded cards showing time, summary, location, and an all-day badge where applicable.
        </div>

        <h3 id="api-rooms">Rooms &amp; Services</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>rooms()</code></td><td>List all rooms/areas and their entity counts.</td></tr>
            <tr><td><code>room(name)</code></td><td>List all entities in a room.</td></tr>
            <tr><td><code>services(domain)</code></td><td>List available services. <code>services("light")</code></td></tr>
          </tbody>
        </table>

        <h3 id="api-utilities">Utilities</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>ago(period)</code></td><td>Convert period string to datetime. <code>ago("6h")</code></td></tr>
            <tr><td><code>now()</code></td><td>Current datetime.</td></tr>
            <tr><td><code>count(domain)</code></td><td>Count entities in a domain.</td></tr>
            <tr><td><code>domains()</code></td><td>List all entity domains.</td></tr>
            <tr><td><code>find(pattern)</code></td><td>Fuzzy search entities by name/ID.</td></tr>
          </tbody>
        </table>

        <h3 id="api-charts">Charts</h3>
        <table>
          <thead><tr><th>Function</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>chart(entity, period)</code></td><td>Explicit chart rendering for an entity.</td></tr>
            <tr><td><code>compare([entities], period)</code></td><td>Multi-entity overlay chart.</td></tr>
          </tbody>
        </table>
        <pre><code class="language-python"># Compare two sensors on one chart
compare(["sensor.indoor_temp", "sensor.outdoor_temp"], "24h")

# Explicit chart for a binary sensor
chart("binary_sensor.front_door", "12h")</code></pre>
      </section>

      <!-- AI Analyst -->
      <section class="section" id="ai-analyst">
        <h2>AI Analyst</h2>
        <p>
          Signal Deck includes a built-in AI analyst that connects to any
          <a href="https://www.home-assistant.io/integrations/conversation/">HA Conversation agent</a>
          (Ollama, OpenAI, Google, local models). It can read your entity states and
          answer questions about your home.
        </p>
        <p>Configure the analyst entity in your card YAML:</p>
        <pre><code class="language-yaml">type: custom:signal-deck
analyst_entity: conversation.ollama  # or any conversation agent</code></pre>
        <p>Then use the analyst button in the REPL toolbar, or ask directly:</p>
        <pre><code class="language-python"># The analyst sees your current HA state and can run commands
# to investigate. It works best with questions like:
# "Why is the kitchen temperature rising?"
# "Which lights are on right now?"
# "Show me the front door history for today"</code></pre>
        <div class="callout info">
          <strong>Optimised for small models</strong>
          The analyst prompt is carefully tuned for local LLMs (Llama, Mistral, Phi) running via Ollama.
          It works with larger models too, but doesn't require them.
        </div>
        <!-- AI ANALYST SCREENSHOT PLACEHOLDER -->
        <div class="media-placeholder">
          <span class="placeholder-icon">&#x1F4F8;</span>
          AI Analyst screenshot &mdash; showing a conversation with the analyst
          <span class="placeholder-hint">docs/images/ai-analyst.png</span>
        </div>
      </section>

      <!-- Architecture -->
      <section class="section" id="architecture">
        <h2>Architecture</h2>
        <p>Signal Deck is built in three layers with strict boundaries:</p>
        <div class="arch-diagram"><span class="layer-ts">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
&#x2502;  TypeScript (Lit Element)                      &#x2502;
&#x2502;  Lovelace card &#xB7; HA WebSocket &#xB7; UI rendering    &#x2502;
&#x2502;  Event subscriptions &#xB7; Security &#xB7; Auth          &#x2502;
&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span>
<span class="layer-rust">&#x2502;  Rust Shell Engine (compiled to WASM)          &#x2502;
&#x2502;  REPL state &#xB7; Command parsing &#xB7; Magics          &#x2502;
&#x2502;  Output shaping &#xB7; Render specs &#xB7; Data transforms &#x2502;
&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span>
<span class="layer-monty">&#x2502;  Monty (Python runtime, sandboxed)              &#x2502;
&#x2502;  Executes user Python snippets only              &#x2502;
&#x2502;  Called by Rust &#xB7; No direct HA access             &#x2502;
&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span></div>

        <h3 id="data-flow">Data Flow</h3>
        <ol>
          <li>User types a command in the REPL</li>
          <li>TypeScript passes input to the Rust WASM engine</li>
          <li>Rust parses, determines if HA data is needed, returns a <strong>host call request</strong></li>
          <li>TypeScript fetches data via HA WebSocket API</li>
          <li>Rust processes data and returns a <strong>render spec</strong> (JSON)</li>
          <li>TypeScript renders the spec as cards, tables, or ECharts</li>
        </ol>

        <h3 id="security">Security Model</h3>
        <ul>
          <li><strong>Read-only by default</strong> &mdash; all state access is read-only</li>
          <li><strong>No direct HA access from WASM</strong> &mdash; all I/O goes through TypeScript host functions</li>
          <li><strong>No filesystem or network</strong> &mdash; the WASM sandbox prevents all external access</li>
          <li><strong>Service calls require arming</strong> &mdash; <code>ha.arm()</code> must be called before any service call</li>
          <li><strong>Auth stays in TypeScript</strong> &mdash; HA auth tokens never reach WASM</li>
        </ul>
      </section>

      <!-- Development -->
      <section class="section" id="development">
        <h2>Development</h2>

        <h3>Prerequisites</h3>
        <ul>
          <li><strong>Rust</strong> (stable) + <code>wasm-pack</code></li>
          <li><strong>Node.js</strong> &ge; 18 + npm</li>
          <li>A Home Assistant instance for testing</li>
        </ul>

        <h3>Building</h3>
        <pre><code class="language-bash"># Clone the repo
git clone https://github.com/rsr5/signal-deck.git
cd signal-deck

# Install JS dependencies
npm install

# Build WASM + TypeScript
npm run build

# Or build each layer separately:
npm run build:wasm    # Rust/WASM only
npm run build:ts      # TypeScript/Rollup only</code></pre>

        <h3>Dev Mode</h3>
        <pre><code class="language-bash"># Watch mode (rebuilds on change)
npm run dev

# Copy dist/signal-deck.js to your HA config/www/ folder
# and add as a resource in Lovelace</code></pre>

        <h3 id="testing">Testing</h3>
        <pre><code class="language-bash"># Run all tests
npm run test:all

# Rust tests (144 tests)
npm run test:rust

# TypeScript tests (19 tests)
npm run test</code></pre>

        <h3 id="project-structure">Project Structure</h3>
        <pre><code class="language-bash">signal-deck/
  crates/shell-engine/     # Rust WASM engine
    src/
      lib.rs               # Entry point + host ABI
      eval.rs              # Expression evaluator
      magic.rs             # Magic commands + :help
      render.rs            # Render spec generation
      calendar.rs          # Calendar event handling
  src/                     # TypeScript
    card.ts                # Lovelace card element
    repl.ts                # REPL UI component
    renderers/             # Render spec renderers
    assistant/             # AI analyst integration
  docs/                    # This documentation site
  dist/                    # Built output</code></pre>

        <h3 id="contributing">Contributing</h3>
        <p>
          We welcome contributions! Please see
          <a href="https://github.com/rsr5/signal-deck/blob/main/CONTRIBUTING.md">CONTRIBUTING.md</a>
          for guidelines.
        </p>
        <div class="callout warning">
          <strong>Three-layer rule</strong>
          Signal Deck has strict architectural boundaries. REPL logic belongs in Rust.
          HA I/O belongs in TypeScript. Python execution belongs in Monty.
          Please read <a href="#architecture">Architecture</a> before submitting a PR.
        </div>
      </section>

      <!-- FAQ -->
      <section class="section" id="faq">
        <h2>FAQ</h2>

        <h3>How big is the bundle?</h3>
        <p>The JS bundle is ~2 MB and the WASM module is ~3.1 MB. Both are loaded lazily and cached by the browser. The WASM file uses content-hash cache busting for reliable updates.</p>

        <h3>Does it need a backend?</h3>
        <p>No. Signal Deck runs entirely in the browser using the HA WebSocket API. There is no custom integration or backend component to install.</p>

        <h3>Is it safe?</h3>
        <p>Yes. All Python runs in a WebAssembly sandbox with no filesystem or network access. State access is read-only by default. Service calls require explicit arming.</p>

        <h3>Which Python version does Monty support?</h3>
        <p>Monty implements a subset of Python 3 sufficient for data exploration &mdash; variables, functions, loops, list comprehensions, dicts, f-strings, and more. It is not a full CPython.</p>

        <h3>Can I use it with my existing dashboards?</h3>
        <p>Absolutely. Signal Deck is a standard Lovelace card. Add it to any view alongside your existing cards. The overlay mode gives you a floating panel that doesn't take up card space.</p>

        <h3>Does the AI analyst send data to the cloud?</h3>
        <p>That depends on your Conversation agent. If you use a local model (Ollama, llama.cpp), everything stays local. Cloud-based agents (OpenAI, Google) will process data on their servers.</p>

        <h3>Which Home Assistant version do I need?</h3>
        <p>Signal Deck requires Home Assistant 2024.1.0 or later for WebSocket API compatibility.</p>

        <h3>Can I run automations from the REPL?</h3>
        <p>Service calls are supported but gated behind an arming mechanism for safety. You must call <code>ha.arm()</code> before any service call, and a confirmation dialog is shown.</p>
      </section>

      <!-- Changelog -->
      <section class="section" id="changelog">
        <h2>Changelog</h2>
        <p>See <a href="https://github.com/rsr5/signal-deck/blob/main/CHANGELOG.md">CHANGELOG.md</a> for the full release history.</p>

        <h3>v0.1.0-alpha.1</h3>
        <p>Initial alpha release with:</p>
        <ul>
          <li>Embedded Python REPL (Monty via WebAssembly)</li>
          <li>Rust shell engine with magic commands and render specs</li>
          <li>Full Python API: state, history, calendar events, rooms, services, charts</li>
          <li>ECharts visualisations with auto-render</li>
          <li>AI analyst integration via HA Conversation</li>
          <li>Embedded and overlay display modes</li>
          <li>Entity auto-resolve and rich entity cards</li>
          <li>HACS-compatible packaging</li>
        </ul>
      </section>

    </main>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>
      Signal Deck is open source under the
      <a href="https://github.com/rsr5/signal-deck/blob/main/LICENSE">MIT License</a>.
      Built by <a href="https://github.com/rsr5">Robin Ridler</a>.
    </p>
    <p style="margin-top: 8px;">
      <a href="https://github.com/rsr5/signal-deck">GitHub</a> &middot;
      <a href="https://github.com/rsr5/signal-deck/issues">Issues</a> &middot;
      <a href="https://github.com/rsr5/signal-deck/discussions">Discussions</a>
    </p>
  </footer>

  <script>
    hljs.highlightAll();
    // Active sidebar link tracking
    var sections = document.querySelectorAll('.section, .hero');
    var sidebarLinks = document.querySelectorAll('.sidebar a');
    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          sidebarLinks.forEach(function(link) { link.classList.remove('active'); });
          var id = entry.target.id;
          var activeLink = document.querySelector('.sidebar a[href="#' + id + '"]');
          if (activeLink) activeLink.classList.add('active');
        }
      });
    }, { rootMargin: '-20% 0px -80% 0px' });
    sections.forEach(function(section) { observer.observe(section); });
  </script>
</body>
</html>
