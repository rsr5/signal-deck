<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signal Deck â€” The oscilloscope for Home Assistant</title>
  <meta name="description" content="A safe Python REPL Lovelace card for Home Assistant with built-in AI analyst, ECharts visualisations, and deep state exploration." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <!-- highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>

  <style>
    /* â”€â”€â”€ CSS Custom Properties â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #1c2128;
      --bg-card: #1c2128;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --text-muted: #656d76;
      --border-color: #30363d;
      --accent: #00e5ff;
      --accent-hover: #00b8d4;
      --accent-subtle: rgba(0, 229, 255, 0.15);
      --accent-alt: #ff6e40;
      --accent-alt-subtle: rgba(255, 110, 64, 0.15);
      --success: #3fb950;
      --warning: #d29922;
      --danger: #f85149;
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'JetBrains Mono', 'Iosevka', 'Fira Code', monospace;
      --max-width: 1200px;
      --sidebar-width: 240px;
      --nav-height: 60px;
      --radius: 8px;
      --radius-lg: 12px;
    }

    /* â”€â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; scroll-padding-top: calc(var(--nav-height) + 24px); }
    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; transition: color 0.15s; }
    a:hover { color: var(--accent-hover); }
    img { max-width: 100%; height: auto; border-radius: var(--radius); }
    code { font-family: var(--font-mono); font-size: 0.9em; }

    /* â”€â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .top-nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(13, 17, 23, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border-color);
      height: var(--nav-height);
      display: flex;
      align-items: center;
      padding: 0 24px;
    }
    .top-nav .logo {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .top-nav .logo .icon {
      font-size: 1.4rem;
    }
    .top-nav-links {
      margin-left: auto;
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .top-nav-links a {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
    }
    .top-nav-links a:hover { color: var(--text-primary); }
    .github-link {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .github-link svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    /* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      max-width: var(--max-width);
      margin: 0 auto;
      gap: 48px;
      padding: 32px 24px;
    }

    /* â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar {
      position: sticky;
      top: calc(var(--nav-height) + 24px);
      align-self: start;
      max-height: calc(100vh - var(--nav-height) - 48px);
      overflow-y: auto;
      padding-right: 16px;
    }
    .sidebar::-webkit-scrollbar { width: 3px; }
    .sidebar::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    .sidebar h4 {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-top: 20px;
      margin-bottom: 8px;
    }
    .sidebar h4:first-child { margin-top: 0; }
    .sidebar a {
      display: block;
      padding: 4px 0;
      font-size: 0.82rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    .sidebar a:hover { color: var(--accent); }
    .sidebar a.active {
      color: var(--accent);
      font-weight: 500;
    }

    /* â”€â”€â”€ Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .content {
      min-width: 0;
      max-width: 820px;
    }

    /* â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      padding: 48px 0 40px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 48px;
    }
    .hero h1 {
      font-size: 2.8rem;
      font-weight: 700;
      line-height: 1.15;
      margin-bottom: 16px;
      background: linear-gradient(135deg, var(--accent), #76ff03);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero .subtitle {
      font-size: 1.15rem;
      color: var(--text-secondary);
      line-height: 1.65;
      max-width: 620px;
      margin-bottom: 24px;
    }
    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 28px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      font-family: var(--font-mono);
    }
    .badge.alpha {
      background: var(--accent-alt-subtle);
      color: var(--accent-alt);
      border: 1px solid rgba(255, 110, 64, 0.3);
    }
    .badge.version {
      background: var(--accent-subtle);
      color: var(--accent);
      border: 1px solid rgba(0, 229, 255, 0.3);
    }
    .badge.license {
      background: rgba(63, 185, 80, 0.15);
      color: var(--success);
      border: 1px solid rgba(63, 185, 80, 0.3);
    }
    .badge.hacs {
      background: rgba(210, 153, 34, 0.15);
      color: var(--warning);
      border: 1px solid rgba(210, 153, 34, 0.3);
    }
    .hero-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: var(--radius);
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    .btn-primary {
      background: var(--accent);
      color: var(--bg-primary);
    }
    .btn-primary:hover {
      background: var(--accent-hover);
      color: var(--bg-primary);
    }
    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--border-color);
    }
    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* â”€â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section {
      margin-bottom: 56px;
    }
    .section h2 {
      font-size: 1.65rem;
      font-weight: 700;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    .section h3 {
      font-size: 1.15rem;
      font-weight: 600;
      margin-top: 32px;
      margin-bottom: 12px;
      color: var(--text-primary);
    }
    .section p {
      margin-bottom: 16px;
      color: var(--text-secondary);
      line-height: 1.7;
    }
    .section ul, .section ol {
      margin-bottom: 16px;
      padding-left: 24px;
      color: var(--text-secondary);
    }
    .section li {
      margin-bottom: 6px;
      line-height: 1.6;
    }
    .section li code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85em;
      color: var(--accent);
    }

    /* â”€â”€â”€ Code Blocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    pre {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 16px 20px;
      overflow-x: auto;
      margin-bottom: 16px;
      position: relative;
    }
    pre code {
      font-size: 0.8rem;
      line-height: 1.6;
      background: none !important;
      padding: 0 !important;
      color: var(--text-primary);
    }
    .code-label {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 0.65rem;
      font-family: var(--font-mono);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    /* Inline code */
    p code, li code, td code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85em;
      color: var(--accent);
    }

    /* â”€â”€â”€ Tables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 16px;
      font-size: 0.875rem;
    }
    th, td {
      text-align: left;
      padding: 10px 14px;
      border-bottom: 1px solid var(--border-color);
    }
    th {
      font-weight: 600;
      color: var(--text-primary);
      background: var(--bg-secondary);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    td {
      color: var(--text-secondary);
    }
    tr:hover td {
      background: rgba(0, 229, 255, 0.03);
    }

    /* â”€â”€â”€ Feature Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 20px;
      transition: border-color 0.2s;
    }
    .feature-card:hover {
      border-color: var(--accent);
    }
    .feature-card .icon {
      font-size: 1.6rem;
      margin-bottom: 10px;
    }
    .feature-card h4 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary);
    }
    .feature-card p {
      font-size: 0.82rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }

    /* â”€â”€â”€ Callouts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .callout {
      border-left: 3px solid;
      padding: 14px 18px;
      border-radius: 0 var(--radius) var(--radius) 0;
      margin-bottom: 16px;
      font-size: 0.875rem;
    }
    .callout.info {
      border-color: var(--accent);
      background: var(--accent-subtle);
      color: var(--accent);
    }
    .callout.warning {
      border-color: var(--warning);
      background: rgba(210, 153, 34, 0.1);
      color: var(--warning);
    }
    .callout.danger {
      border-color: var(--danger);
      background: rgba(248, 81, 73, 0.1);
      color: var(--danger);
    }
    .callout strong {
      display: block;
      margin-bottom: 4px;
    }

    /* â”€â”€â”€ Architecture Diagram â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .arch-diagram {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      font-family: var(--font-mono);
      font-size: 0.78rem;
      line-height: 1.5;
      color: var(--text-secondary);
      overflow-x: auto;
      margin-bottom: 16px;
      white-space: pre;
    }
    .arch-diagram .layer-ts { color: #58a6ff; }
    .arch-diagram .layer-rust { color: var(--accent-alt); }
    .arch-diagram .layer-monty { color: var(--success); }

    /* â”€â”€â”€ Keyboard Shortcut Keys â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    kbd {
      display: inline-block;
      padding: 2px 7px;
      font-family: var(--font-mono);
      font-size: 0.78rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 1px 0 var(--border-color);
      color: var(--text-primary);
    }

    /* â”€â”€â”€ Screenshot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .screenshot {
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
    }
    .screenshot img {
      display: block;
      width: 100%;
      border-radius: 0;
    }
    .screenshot-caption {
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 8px;
      margin-bottom: 24px;
    }

    /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 32px 24px;
      border-top: 1px solid var(--border-color);
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
        gap: 24px;
        padding: 16px;
      }
      .sidebar { display: none; }
      .hero h1 { font-size: 2rem; }
      .hero { padding: 32px 0 24px; }
      .feature-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- TOP NAV                                                    -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="top-nav">
  <a href="#" class="logo">
    <span class="icon">ğŸ“¡</span>
    <span>Signal Deck</span>
  </a>
  <div class="top-nav-links">
    <a href="#installation">Install</a>
    <a href="#getting-started">Guide</a>
    <a href="#api-reference">API</a>
    <a href="#ai-analyst">AI Analyst</a>
    <a href="https://github.com/rr-codes/signal-deck" class="github-link" target="_blank" rel="noopener">
      <svg viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
      GitHub
    </a>
  </div>
</nav>

<div class="layout">
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SIDEBAR                                                    -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">
  <h4>Getting Started</h4>
  <a href="#overview">Overview</a>
  <a href="#installation">Installation</a>
  <a href="#getting-started">Quick Start</a>
  <a href="#card-config">Card Configuration</a>

  <h4>Using the REPL</h4>
  <a href="#repl-basics">REPL Basics</a>
  <a href="#magic-commands">Magic Commands</a>
  <a href="#auto-resolve">Auto-resolve</a>
  <a href="#keyboard-shortcuts">Keyboard Shortcuts</a>

  <h4>Python API</h4>
  <a href="#api-reference">API Reference</a>
  <a href="#api-state">State &amp; Entities</a>
  <a href="#api-history">History &amp; Diagnostics</a>
  <a href="#api-rooms">Rooms &amp; Services</a>
  <a href="#api-utilities">Utilities</a>
  <a href="#api-charts">Charts</a>

  <h4>AI Analyst</h4>
  <a href="#ai-analyst">Signal Analyst</a>
  <a href="#ai-examples">Example Queries</a>

  <h4>Architecture</h4>
  <a href="#architecture">Three-Layer Design</a>
  <a href="#security">Security Model</a>

  <h4>Development</h4>
  <a href="#development">Building</a>
  <a href="#testing">Testing</a>
  <a href="#contributing">Contributing</a>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- CONTENT                                                    -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="content">

<!-- â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="hero" id="overview">
  <div class="badges">
    <span class="badge alpha">âš  alpha</span>
    <span class="badge version">v0.1.0</span>
    <span class="badge license">MIT</span>
    <span class="badge hacs">HACS</span>
  </div>
  <h1>Signal Deck</h1>
  <p class="subtitle">
    The oscilloscope for Home Assistant. A safe Python REPL embedded in Lovelace with a built-in AI analyst, rich charts, and deep state exploration â€” all running entirely in your browser.
  </p>
  <div class="hero-actions">
    <a href="#installation" class="btn btn-primary">Get Started</a>
    <a href="https://github.com/rr-codes/signal-deck" class="btn btn-secondary" target="_blank" rel="noopener">
      <svg viewBox="0 0 16 16" width="16" height="16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
      GitHub
    </a>
  </div>
</section>

<!-- â”€â”€â”€ WHAT IS SIGNAL DECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="features">
  <h2>What is Signal Deck?</h2>
  <p>
    Signal Deck is a custom Lovelace card that gives you a <strong>safe, sandboxed Python shell</strong> right inside
    Home Assistant. It's designed for power users who want to explore entity state, debug automations, visualise
    history data, and ask an AI analyst questions about their home â€” all without leaving their dashboard.
  </p>

  <p>
    Built on <a href="https://github.com/pydantic/monty" target="_blank" rel="noopener">Monty</a> â€” Pydantic's
    Python-in-WASM runtime â€” and a custom Rust shell engine compiled to WebAssembly.
  </p>

  <div class="feature-grid">
    <div class="feature-card">
      <div class="icon">ğŸ</div>
      <h4>Python REPL</h4>
      <p>Powered by <a href="https://github.com/pydantic/monty" target="_blank" rel="noopener">Monty</a> from Pydantic â€” a Python interpreter compiled to WebAssembly for safe, sandboxed execution.</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ¤–</div>
      <h4>AI Signal Analyst</h4>
      <p>Built-in AI assistant that writes and executes Python against your live HA state. Powered by HA Conversation.</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ“Š</div>
      <h4>ECharts Visualisations</h4>
      <p>Line, bar, pie, and time-series charts with one function call. Auto-themed to match Signal Deck.</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ”</div>
      <h4>Deep State Explorer</h4>
      <p>Magic commands to search, compare, and inspect entities â€” attributes, history, diffs, and more.</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ”’</div>
      <h4>Safe by Default</h4>
      <p>Read-only state access. Service calls require explicit confirmation. No filesystem or network access.</p>
    </div>
    <div class="feature-card">
      <div class="icon">ğŸ–¥ï¸</div>
      <h4>Overlay Mode</h4>
      <p>A Quake-style drop-down console that stays hidden until you need it. Toggle with backtick.</p>
    </div>
  </div>
</section>

<!-- â”€â”€â”€ SCREENSHOTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!--
<section class="section">
  <h2>Screenshots</h2>
  <div class="screenshot">
    <img src="images/hero.png" alt="Signal Deck REPL in action" />
  </div>
  <p class="screenshot-caption">The Signal Deck REPL embedded in a Lovelace dashboard</p>
</section>
-->

<!-- â”€â”€â”€ INSTALLATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="installation">
  <h2>Installation</h2>

  <div class="callout warning">
    <strong>âš  Alpha Software</strong>
    Signal Deck is in active development. APIs may change between releases. Please report bugs on GitHub.
  </div>

  <h3>HACS (Recommended)</h3>
  <ol>
    <li>Open HACS in Home Assistant</li>
    <li>Click the three-dot menu â†’ <strong>Custom repositories</strong></li>
    <li>Add the repository URL: <code>https://github.com/rr-codes/signal-deck</code></li>
    <li>Select category: <strong>Lovelace</strong></li>
    <li>Click <strong>Add</strong>, then find Signal Deck and install it</li>
    <li>Restart Home Assistant</li>
  </ol>

  <h3>Manual Installation</h3>
  <ol>
    <li>Download <code>signal-deck.js</code> from the
      <a href="https://github.com/rr-codes/signal-deck/releases" target="_blank" rel="noopener">latest release</a></li>
    <li>Copy it to <code>/config/www/signal-deck/signal-deck.js</code></li>
    <li>Add the resource in Settings â†’ Dashboards â†’ Resources:</li>
  </ol>
  <pre><code class="language-yaml">url: /local/signal-deck/signal-deck.js
type: module</code></pre>
</section>

<!-- â”€â”€â”€ GETTING STARTED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="getting-started">
  <h2>Quick Start</h2>
  <p>Add Signal Deck to any Lovelace dashboard:</p>
  <pre><code class="language-yaml">type: custom:signal-deck
title: Signal Deck</code></pre>

  <p>That's it! You'll see a terminal-style REPL. Try these commands:</p>

  <pre><code class="language-python"># Check the state of an entity
state("sensor.living_room_temperature")

# List all lights
states("light")

# See entity history
history("sensor.power_consumption", 12)

# Search for entities
%find *occupied*

# Ask the AI analyst
%ask why is the kitchen light on?</code></pre>
</section>

<!-- â”€â”€â”€ CARD CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="card-config">
  <h2>Card Configuration</h2>

  <table>
    <thead>
      <tr>
        <th>Option</th>
        <th>Type</th>
        <th>Default</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>title</code></td>
        <td>string</td>
        <td><em>none</em></td>
        <td>Card title displayed in the header</td>
      </tr>
      <tr>
        <td><code>height</code></td>
        <td>string</td>
        <td><em>auto</em></td>
        <td>Card height as CSS value (e.g. <code>"500px"</code>)</td>
      </tr>
      <tr>
        <td><code>mode</code></td>
        <td>string</td>
        <td><code>"embedded"</code></td>
        <td><code>"embedded"</code> â€” inline card<br><code>"overlay"</code> â€” floating console</td>
      </tr>
      <tr>
        <td><code>overlay_position</code></td>
        <td>string</td>
        <td><code>"top"</code></td>
        <td><code>"top"</code> Â· <code>"bottom"</code> Â· <code>"full"</code></td>
      </tr>
      <tr>
        <td><code>overlay_height</code></td>
        <td>string</td>
        <td><code>"50vh"</code></td>
        <td>Overlay panel height (for <code>top</code>/<code>bottom</code>)</td>
      </tr>
      <tr>
        <td><code>show_analyst</code></td>
        <td>boolean</td>
        <td><code>true</code></td>
        <td>Show the AI Signal Analyst tab</td>
      </tr>
      <tr>
        <td><code>agent_id</code></td>
        <td>string</td>
        <td><em>auto</em></td>
        <td>HA Conversation agent ID for the analyst</td>
      </tr>
    </tbody>
  </table>

  <h3>Embedded Mode</h3>
  <pre><code class="language-yaml">type: custom:signal-deck
title: My Shell
height: 600px</code></pre>

  <h3>Overlay Mode</h3>
  <p>Overlay mode renders a tiny launcher button. Click it (or press <kbd>`</kbd>) to reveal a Quake-style console.</p>
  <pre><code class="language-yaml">type: custom:signal-deck
mode: overlay
overlay_position: top
overlay_height: 50vh</code></pre>

  <h3>AI Analyst with Specific Agent</h3>
  <pre><code class="language-yaml">type: custom:signal-deck
agent_id: conversation.claude_sonnet</code></pre>
</section>

<!-- â”€â”€â”€ REPL BASICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="repl-basics">
  <h2>Using the REPL</h2>
  <p>
    The Signal Deck REPL supports standard Python syntax plus special <strong>magic commands</strong> and
    <strong>auto-resolve shortcuts</strong>. Everything runs inside a sandboxed WebAssembly interpreter â€” there
    is no server-side code execution.
  </p>

  <h3 id="magic-commands">Magic Commands</h3>
  <p>Magic commands start with <code>%</code> or <code>:</code> and provide quick access to common operations:</p>

  <table>
    <thead>
      <tr>
        <th>Command</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr><td><code>:help</code></td><td>Show the help reference</td></tr>
      <tr><td><code>:clear</code></td><td>Clear the output</td></tr>
      <tr><td><code>%ls [domain]</code></td><td>List entities, optionally filtered by domain</td></tr>
      <tr><td><code>%get &lt;entity_id&gt;</code></td><td>Show entity state and attributes</td></tr>
      <tr><td><code>%find &lt;pattern&gt;</code></td><td>Search entities by glob pattern</td></tr>
      <tr><td><code>%hist &lt;id&gt; [-h N]</code></td><td>Show entity history (last N hours)</td></tr>
      <tr><td><code>%attrs &lt;id&gt;</code></td><td>Show all entity attributes</td></tr>
      <tr><td><code>%diff &lt;id1&gt; &lt;id2&gt;</code></td><td>Compare two entities side-by-side</td></tr>
      <tr><td><code>%bundle &lt;name&gt;</code></td><td>Run a named bundle</td></tr>
      <tr><td><code>%fmt &lt;format&gt;</code></td><td>Set output format (<code>table</code>, <code>json</code>, <code>text</code>)</td></tr>
      <tr><td><code>%ask &lt;question&gt;</code></td><td>Ask the AI Signal Analyst</td></tr>
    </tbody>
  </table>

  <h3 id="auto-resolve">Auto-resolve</h3>
  <p>
    You can type entity IDs or domain names directly â€” Signal Deck resolves them automatically:
  </p>
  <pre><code class="language-python"># Typing just an entity ID runs %get
sensor.living_room_temperature
# â†’ equivalent to: %get sensor.living_room_temperature

# Typing a domain runs %ls
light
# â†’ equivalent to: %ls light</code></pre>

  <h3 id="keyboard-shortcuts">Keyboard Shortcuts</h3>
  <table>
    <thead>
      <tr>
        <th>Key</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr><td><kbd>`</kbd> (backtick)</td><td>Toggle overlay open/close (overlay mode)</td></tr>
      <tr><td><kbd>Escape</kbd></td><td>Close overlay</td></tr>
      <tr><td><kbd>â†‘</kbd> / <kbd>â†“</kbd></td><td>Navigate command history</td></tr>
      <tr><td><kbd>Enter</kbd></td><td>Execute command</td></tr>
    </tbody>
  </table>
</section>

<!-- â”€â”€â”€ API REFERENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="api-reference">
  <h2>Python API Reference</h2>
  <p>
    Signal Deck provides a focused Python API for interacting with Home Assistant. All functions
    are available as top-level names â€” no imports needed.
  </p>

  <!-- State & Entities -->
  <h3 id="api-state">State &amp; Entities</h3>
  <table>
    <thead>
      <tr>
        <th>Function</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>state(entity_id)</code></td>
        <td>Get entity state as an <code>EntityState</code> dataclass with <code>.state</code>, <code>.attributes</code>, <code>.last_changed</code></td>
      </tr>
      <tr>
        <td><code>states([domain])</code></td>
        <td>List all entity states, optionally filtered by domain (e.g. <code>states("light")</code>)</td>
      </tr>
      <tr>
        <td><code>entities(entity_id)</code></td>
        <td>Get entity registry entry â€” integration, device, platform details</td>
      </tr>
      <tr>
        <td><code>devices([query])</code></td>
        <td>List or search devices</td>
      </tr>
    </tbody>
  </table>

  <pre><code class="language-python"># Get a single entity
s = state("sensor.power")
show(s)
# â†’ EntityState(state='1234', unit='W', last_changed=...)

# List all binary sensors
states("binary_sensor")</code></pre>

  <!-- History & Diagnostics -->
  <h3 id="api-history">History &amp; Diagnostics</h3>
  <table>
    <thead>
      <tr>
        <th>Function</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>history(id, [hours])</code></td>
        <td>Get entity history (default 6 hours)</td>
      </tr>
      <tr>
        <td><code>statistics(id, [hours], [period])</code></td>
        <td>Get long-term statistics</td>
      </tr>
      <tr>
        <td><code>logbook([id], [hours])</code></td>
        <td>Get logbook entries</td>
      </tr>
      <tr>
        <td><code>traces([automation_id])</code></td>
        <td>Get automation/script traces (all or specific)</td>
      </tr>
      <tr>
        <td><code>error_log()</code></td>
        <td>Fetch the HA error log</td>
      </tr>
      <tr>
        <td><code>check_config()</code></td>
        <td>Validate HA configuration</td>
      </tr>
    </tbody>
  </table>

  <div class="callout info">
    <strong>ğŸ’¡ Auto-render</strong>
    <code>history()</code>, <code>traces()</code>, <code>logbook()</code>, <code>statistics()</code>, and <code>error_log()</code> 
    produce rich formatted output automatically. Call them as bare expressions â€” no need to wrap in <code>show()</code>.
  </div>

  <pre><code class="language-python"># Last 12 hours of temperature
history("sensor.outdoor_temp", 12)

# Automation traces
traces("automation.motion_lights")

# Check configuration validity
check_config()</code></pre>

  <!-- Rooms & Services -->
  <h3 id="api-rooms">Rooms &amp; Services</h3>
  <table>
    <thead>
      <tr>
        <th>Function</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>room(name)</code></td>
        <td>Get all entities in an area/room</td>
      </tr>
      <tr>
        <td><code>rooms()</code></td>
        <td>List all areas/rooms</td>
      </tr>
      <tr>
        <td><code>services([domain])</code></td>
        <td>List available services</td>
      </tr>
      <tr>
        <td><code>call_service(domain, service, data)</code></td>
        <td>Call a HA service (requires confirmation)</td>
      </tr>
    </tbody>
  </table>

  <pre><code class="language-python"># What's in the living room?
room("living_room")

# List all rooms
rooms()

# Call a service (will prompt for confirmation)
call_service("light", "turn_off", {"entity_id": "light.kitchen"})</code></pre>

  <!-- Utilities -->
  <h3 id="api-utilities">Utilities</h3>
  <table>
    <thead>
      <tr>
        <th>Function</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>show(value)</code></td>
        <td>Pretty-print any value</td>
      </tr>
      <tr>
        <td><code>now()</code></td>
        <td>Current date/time</td>
      </tr>
      <tr>
        <td><code>ago(spec)</code></td>
        <td>Relative time â€” e.g. <code>ago("6h")</code>, <code>ago("2d")</code>, <code>ago("30m")</code></td>
      </tr>
      <tr>
        <td><code>template(tpl)</code></td>
        <td>Render a Jinja2 template via HA</td>
      </tr>
    </tbody>
  </table>

  <!-- Charts -->
  <h3 id="api-charts">Charts (ECharts)</h3>
  <p>
    Signal Deck includes built-in charting powered by Apache ECharts. Charts are rendered inline in
    the REPL output, auto-themed to match Signal Deck's dark aesthetic.
  </p>

  <table>
    <thead>
      <tr>
        <th>Function</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>plot_line(labels, values, [title])</code></td>
        <td>Line chart</td>
      </tr>
      <tr>
        <td><code>plot_bar(labels, values, [title])</code></td>
        <td>Bar chart</td>
      </tr>
      <tr>
        <td><code>plot_pie(data, [title])</code></td>
        <td>Pie chart â€” <code>data</code> is <code>{"name": value, ...}</code></td>
      </tr>
      <tr>
        <td><code>plot_series(points, [title])</code></td>
        <td>XY / time-series line chart</td>
      </tr>
    </tbody>
  </table>

  <h3>Chart Examples</h3>
  <pre><code class="language-python"># Simple line chart
labels = ["Mon", "Tue", "Wed", "Thu", "Fri"]
temps = [18.2, 19.5, 17.8, 20.1, 19.3]
plot_line(labels, temps, "Weekly Temperature")

# Pie chart from a dictionary
usage = {"Heating": 45, "Lighting": 20, "Appliances": 35}
plot_pie(usage, "Energy Breakdown")

# Multi-series bar chart
plot_bar(
    ["Kitchen", "Bedroom", "Office"],
    {"Temperature": [22, 19, 21], "Humidity": [45, 55, 40]},
    "Room Comparison"
)

# Time-series from history data
h = history("sensor.power_consumption", 24)
points = [(e["last_changed"], float(e["state"])) for e in h]
plot_series(points, "Power Consumption (24h)")

# Multi-series time-series
plot_series({
    "Indoor": indoor_points,
    "Outdoor": outdoor_points,
}, "Temperature Comparison")</code></pre>

  <div class="callout info">
    <strong>ğŸ“ˆ Choosing the right chart</strong>
    Use <code>plot_pie</code> for proportions, <code>plot_bar</code> for comparisons,
    <code>plot_line</code> for categorical trends, and <code>plot_series</code> for time-series data
    with timestamps. Time axes are auto-detected when x-values are epoch milliseconds.
  </div>
</section>

<!-- â”€â”€â”€ AI ANALYST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="ai-analyst">
  <h2>AI Signal Analyst</h2>
  <p>
    Signal Deck includes a built-in AI assistant called the <strong>Signal Analyst</strong>. It connects to
    your Home Assistant Conversation integration (any LLM agent â€” Claude, Ollama, etc.) and can write and
    execute Python code against your live HA state.
  </p>

  <p>
    The analyst works in an iterative loop: it writes code, executes it, sees the results, and continues
    until it can answer your question. It has full access to the Signal Deck Python API.
  </p>

  <h3>Accessing the Analyst</h3>
  <p>You can reach the analyst in two ways:</p>
  <ul>
    <li>Click the <strong>Signal Analyst</strong> tab in the card header</li>
    <li>Use the <code>%ask</code> magic command from the REPL: <code>%ask why is the heating on?</code></li>
  </ul>

  <h3 id="ai-examples">Example Queries</h3>
  <pre><code class="language-python"># Natural language questions
%ask which rooms are currently occupied?
%ask why did the kitchen light turn on at 3am?
%ask show me power consumption over the last 24 hours
%ask compare indoor and outdoor temperature
%ask which automations ran today?
%ask is my config valid?
%ask chart the agile electricity prices</code></pre>

  <h3>Choosing an LLM Agent</h3>
  <p>
    The analyst uses whatever HA Conversation agent is configured. For best results, use
    <strong>Claude 3.5 Sonnet</strong> or a similar capable model. Smaller local models (â‰¤ 8B) work
    but may need simpler questions.
  </p>
  <p>You can pin a specific agent in the card config:</p>
  <pre><code class="language-yaml">type: custom:signal-deck
agent_id: conversation.claude_sonnet</code></pre>
</section>

<!-- â”€â”€â”€ ARCHITECTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="architecture">
  <h2>Architecture</h2>
  <p>
    Signal Deck uses a <strong>three-layer architecture</strong> with strict boundaries between
    I/O, logic, and execution:
  </p>

  <div class="arch-diagram"><span class="layer-ts">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TypeScript (Lit Element)                           â”‚
â”‚  Lovelace card Â· HA WebSocket bridge Â· UI rendering â”‚
â”‚  Event subscriptions Â· scheduling Â· HACS packaging  â”‚</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<span class="layer-rust">â”‚  Rust Shell Engine (compiled to WASM)               â”‚
â”‚  REPL state Â· command parsing Â· magics Â· history    â”‚
â”‚  Output shaping Â· render-spec generation            â”‚
â”‚  Data transforms Â· bundles Â· chart building         â”‚</span>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<span class="layer-monty">â”‚  Monty Python Runtime (Pydantic Â· sandboxed WASM)   â”‚
â”‚  Executes user Python snippets only                 â”‚
â”‚  Called by Rust Â· no direct HA access               â”‚</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

  <h3>Data Flow</h3>
  <ol>
    <li>User types a command in the REPL</li>
    <li><strong>TypeScript</strong> sends the input to the <strong>Rust</strong> shell engine (WASM)</li>
    <li><strong>Rust</strong> parses the command â€” magic commands are handled directly; Python code is passed to <strong>Monty</strong></li>
    <li>If the code needs HA data (e.g. <code>state("sensor.temp")</code>), Rust returns a <strong>host call request</strong></li>
    <li><strong>TypeScript</strong> fetches data via the HA WebSocket API and passes it back to Rust</li>
    <li><strong>Rust</strong> processes the data and returns a <strong>render spec</strong> (table, chart, text, etc.)</li>
    <li><strong>TypeScript</strong> renders the spec to the DOM</li>
  </ol>

  <h3 id="security">Security Model</h3>
  <p>Signal Deck is designed to be safe by default:</p>
  <ul>
    <li><strong>Sandboxed execution</strong> â€” Python runs in WebAssembly with no filesystem, network, or system access</li>
    <li><strong>Read-only by default</strong> â€” All state access is read-only</li>
    <li><strong>Gated service calls</strong> â€” <code>call_service()</code> requires explicit user confirmation before executing</li>
    <li><strong>No backend</strong> â€” Everything runs in the browser via the HA WebSocket API</li>
    <li><strong>No code injection</strong> â€” The Rust engine controls what Python code can do via a strict ABI</li>
  </ul>
</section>

<!-- â”€â”€â”€ DEVELOPMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="development">
  <h2>Development</h2>
  <p>Signal Deck has two build steps: the Rust/WASM shell engine and the TypeScript Lovelace card.</p>

  <h3>Prerequisites</h3>
  <ul>
    <li><a href="https://www.rust-lang.org/tools/install" target="_blank" rel="noopener">Rust</a> (stable toolchain)</li>
    <li><a href="https://rustwasm.github.io/wasm-pack/" target="_blank" rel="noopener">wasm-pack</a></li>
    <li><a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a> â‰¥ 18</li>
    <li>npm</li>
  </ul>

  <h3>Building</h3>
  <pre><code class="language-bash"># Clone the repository
git clone https://github.com/rr-codes/signal-deck.git
cd signal-deck

# Install JS dependencies
npm install

# Build the Rust shell engine â†’ WASM
npm run build:wasm

# Build the Lovelace card bundle
npm run build:ts

# Or build everything at once
npm run build</code></pre>

  <p>The final output is <code>dist/signal-deck.js</code> (â‰ˆ770 KB).</p>

  <h3 id="testing">Testing</h3>
  <pre><code class="language-bash"># Rust tests (167 tests)
cargo test

# TypeScript tests (Vitest)
npx vitest run</code></pre>

  <h3>Project Structure</h3>
  <pre><code class="language-bash">signal-deck/
â”œâ”€â”€ crates/shell-engine/     # Rust shell engine
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ engine.rs        # Core REPL engine + chart builders
â”‚       â”œâ”€â”€ magic.rs         # Magic command parser + help text
â”‚       â”œâ”€â”€ monty_runtime.rs # Monty Python integration
â”‚       â””â”€â”€ lib.rs           # WASM entry points
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ signal-deck.ts       # Main Lit Element card
â”‚   â”œâ”€â”€ types/               # TypeScript types
â”‚   â””â”€â”€ assistant/
â”‚       â””â”€â”€ analyst-session.ts  # AI analyst agent loop
â”œâ”€â”€ pkg/                     # WASM build output (synced)
â”œâ”€â”€ dist/                    # Final card bundle
â”œâ”€â”€ rollup.config.js         # Rollup build config
â””â”€â”€ docs/                    # This documentation</code></pre>

  <h3 id="contributing">Contributing</h3>
  <p>
    Contributions are welcome! Please read the architecture section above and respect the three-layer
    boundaries:
  </p>
  <ul>
    <li><strong>Rust</strong> owns REPL logic, magics, parsing, output shaping, and data transforms</li>
    <li><strong>Monty</strong> only executes user Python snippets</li>
    <li><strong>TypeScript</strong> owns HA I/O, DOM rendering, and Lovelace lifecycle</li>
  </ul>

  <div class="callout info">
    <strong>ğŸ’¡ Tip</strong>
    When adding a new Python API function, update three places:
    (1) <code>HA_EXTERNAL_FUNCTIONS</code> in <code>monty_runtime.rs</code>,
    (2) the <code>:help</code> text in <code>magic.rs</code>, and
    (3) the AI analyst system prompt in <code>analyst-session.ts</code>.
  </div>
</section>

<!-- â”€â”€â”€ FAQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section" id="faq">
  <h2>FAQ</h2>

  <h3>Is this safe to run on my Home Assistant?</h3>
  <p>
    Yes. Signal Deck runs entirely in your browser. Python code is sandboxed in WebAssembly with no
    filesystem or network access. State access is read-only, and service calls require explicit confirmation.
  </p>

  <h3>Does this need a backend/add-on?</h3>
  <p>
    No. Signal Deck is a pure Lovelace card. It uses the standard HA WebSocket API for all data access.
    No backend, no add-on, no server-side code.
  </p>

  <h3>Which LLM works best with the AI analyst?</h3>
  <p>
    Claude 3.5 Sonnet via the HA Conversation integration gives the best results. Smaller local models
    (Llama 3.1 8B, Qwen 2.5, etc.) also work for simpler queries. The system prompt is tuned for small models.
  </p>

  <h3>Can I automate things with Signal Deck?</h3>
  <p>
    You can call HA services via <code>call_service()</code>, but each call requires user confirmation.
    Signal Deck is designed as an observability and debugging tool, not an automation engine.
  </p>

  <h3>How big is the card bundle?</h3>
  <p>
    About 770 KB total, including the Rust/WASM shell engine, Monty Python runtime, and ECharts.
    The WASM module is lazy-loaded on first use.
  </p>

  <h3>Can I use this without the AI analyst?</h3>
  <p>
    Absolutely. The REPL and all Python API functions work independently. Set <code>show_analyst: false</code>
    in the card config to hide the analyst tab entirely.
  </p>
</section>

</main>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- FOOTER                                                     -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer class="footer">
  <p>
    Signal Deck â€” The oscilloscope for Home Assistant<br>
    Made by <a href="https://github.com/rr-codes" target="_blank" rel="noopener">Robin Ridler</a> Â· MIT License
  </p>
</footer>

<script>
  // â”€â”€â”€ highlight.js init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  hljs.highlightAll();

  // â”€â”€â”€ Active sidebar link tracking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const sidebarLinks = document.querySelectorAll('.sidebar a');
  const sections = document.querySelectorAll('.section, .hero');

  function updateActive() {
    let current = '';
    sections.forEach(section => {
      const top = section.offsetTop - 100;
      if (window.scrollY >= top) {
        current = section.id;
      }
    });
    sidebarLinks.forEach(link => {
      link.classList.toggle('active', link.getAttribute('href') === '#' + current);
    });
  }

  window.addEventListener('scroll', updateActive, { passive: true });
  updateActive();
</script>

</body>
</html>
